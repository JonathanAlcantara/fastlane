version: '2'

services:
  mongo:
    image: mongo
    ports:
      - "10101:27017"
    volumes:
      - /tmp/fastlane/mongo:/data/db
  redis:
    image: redis
    ports:
      - "10100:6379"
    volumes:
      - /tmp/fastlane/redis:/data
  redis2:
    image: redis:3.2-alpine
    volumes:
      - /tmp/fastlane/redis2:/data
    ports:
      - "10102:6379"
  redis-sentinel:
    build:
      context: ./redis-sentinel
    volumes:
      - /tmp/fastlane/redis-sentinel:/data
    links:
      - redis2
    ports:
      - "10103:26379"
  docker-host:
    image: docker:stable-dind
    privileged: true
    ports:
      - "1234:2375"

  # prometheus https://github.com/alexellis/quickstart-prometheus
  prom:
    image: quay.io/prometheus/prometheus:v2.0.0
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command: "--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus"
    ports:
      - 9090:9090
    depends_on:
      - exporter
  push-gateway:
    image: prom/pushgateway
    ports:
      - "9091:9091"
  exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    depends_on:
      - prom
